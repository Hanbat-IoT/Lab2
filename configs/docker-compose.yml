version: '3.8'

services:
  # Jetson Nano Client (Python 3.6.9)
  jetson-client:
    build:
      context: ..
      dockerfile: configs/Dockerfile.jetson
    image: fl-client-jetson:latest
    container_name: fl-jetson-client
    runtime: nvidia
    network_mode: host
    environment:
      - CLIENT_ID=0
      - SERVER_ADDRESS=localhost:8080
      - DATASET=mnist
      - DATA_SIZE=1500
    command: >
      python3 flower_client.py
      --client_id ${CLIENT_ID:-0}
      --server_address ${SERVER_ADDRESS:-localhost:8080}
      --dataset ${DATASET:-mnist}
      --data_size ${DATA_SIZE:-1500}
    restart: unless-stopped

  # Raspberry Pi Client (Python 3.9+)
  rpi-client:
    build:
      context: ..
      dockerfile: configs/Dockerfile.rpi
    image: fl-client-rpi:latest
    container_name: fl-rpi-client
    network_mode: host
    environment:
      - CLIENT_ID=1
      - SERVER_ADDRESS=localhost:8080
      - DATASET=mnist
      - DATA_SIZE=2000
    command: >
      python3 flower_client.py
      --client_id ${CLIENT_ID:-1}
      --server_address ${SERVER_ADDRESS:-localhost:8080}
      --dataset ${DATASET:-mnist}
      --data_size ${DATA_SIZE:-2000}
    restart: unless-stopped
